{% extends 'base.html' %}
{% block content %}

{% if graph.graph_json %}
<pre hidden id="graph-json">{{ graph.graph_json }}</pre>
{% else %}
<pre hidden id="graph-json">{"nodes": [], "edges": []}</pre>
{% endif %}

<div class="graph-ui">
  <dl>
    <dt>Nodes</dt>
    <dd>Students, unique by student number</dd>
    <dt>Edges</dt>
    <dd>An edge between two nodes represents the existence of at least one pair of submissions that have a similarity higher than the specified minimum similarity. Edge weights represent the amount of such pairs.</dd>
  </dl>

  <div class="row">
      <div class="col-md-6 build-args-ui">
          <h4>Build parameters</h4>
          <div class="slidecontainer">
            <b>Minimum match similarity</b>
            <input type="range" class="slider" id="min-similarity-range"
                   value="0.95" min="0.00" max="1.00" step="0.01">
            <p id="min-similarity-range-value">0.95</p>
          </div>
          <button id="build-graph-button" type="button" class="btn btn-outline-warning"
                  autocomplete="off">
            Build graph
          </button>
          <button id="invalidate-graph-button" type="button" class="btn btn-outline-warning"
                  autocomplete="off">
            Invalidate server graph cache
          </button>
      </div>

      <div class="col-md-6 filter-ui">
          <h4>Graph control</h4>
          <div class="slidecontainer">
            <b>Filter minimum match count</b>
            <input type="range" class="slider" id="min-match-count-range"
                   value="2" min="1" max="20" step="1">
            <p id="min-match-count-range-value">2</p>
          </div>
          <button id="refresh-graph-button" type="button" class="btn btn-outline-primary"
                  aria-pressed="false" autocomplete="off">
            Refresh
          </button>
          <button id="shuffle-layout-button" type="button" class="btn btn-outline-primary"
                  aria-pressed="false" autocomplete="off">
            Shuffle graph layout
          </button>
      </div>
  </div>

  <div hidden id="load-progress" class="progress">
      <div class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
          <span class="loader-message"></span>
      </div>
  </div>
</div>

<div id="pair-comparisons-summary-modal" class="modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title"></h4>
      </div>
      <div class="modal-body">
      </div>
    </div>
  </div>
</div>

<div id="graph-container"></div>

{% csrf_token %}
<script src="/static/graph/graph.js"></script>
{% if graph.graph_json %}
<script>drawGraphFromJSON("graph-json");</script>
{% else %}
<script>drawGraphAsync();</script>
{% endif %}

{% endblock %}
